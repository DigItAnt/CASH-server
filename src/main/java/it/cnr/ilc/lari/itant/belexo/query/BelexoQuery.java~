package it.cnr.ilc.lari.itant.belexo.query;

import java.util.List;
import java.util.ArrayList;

import javax.jcr.Node;
import javax.jcr.Session;
import javax.jcr.Value;
import javax.jcr.query.Query;
import javax.jcr.query.QueryManager;
import javax.jcr.query.QueryResult;
import javax.jcr.query.Row;
import javax.jcr.query.RowIterator;

import it.cnr.ilc.lari.itant.belexo.JcrManager;

public class BelexoQuery {    
    public static List<Node> nodesQuery(String statement) {
        List<Node> ret = new ArrayList<Node>();
        Session session = null;
        try {
            JcrManager.init();
            session = JcrManager.getSession();
            QueryManager qm = session.getWorkspace().getQueryManager();
            Query query = qm.createQuery(statement, Query.JCR_SQL2);
            QueryResult result = query.execute();
            String[] columns = result.getColumnNames();

            for (String column: columns)
                System.out.println("COLUMN: " + column);

            RowIterator riter = result.getRows();
            while (riter.hasNext()) {
                Row row = riter.nextRow();
                Node node = row.getNode("node");
                ret.add(node);
                System.out.println("\n\n\nNODEEEEEE \n\n\n" + node.getPath());
                //JcrManager.logProperties(node);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            if (session != null) session.logout();
        }
        return ret;
    }
}
